"use strict";!function(){function e(e){var t=window.matchMedia("(orientation:portrait)");t.matches?document.getElementById("controlView").style.display="block":document.getElementById("controlView").style.display="none"}function t(){window.DeviceOrientationEvent&&(window.addEventListener("deviceorientation",e),e()),h.connect(),o(),w=document.getElementById("viewText"),R=document.getElementById("infosText"),w.innerText="POUR LANCER LA PARTIE TOUCHER AVEC DEUX DOIGTS LA PARTIE DROITE DE L'ECRAN",R.innerText="NUMBER OF PLAYER : 1",v=document.getElementById("lives"),T=document.getElementById("viewScore"),h.onReceivedClose(function(e){console.log("event: "+JSON.stringify(e)),w.innerText="",R.innerText="DISCONNECT !!"}),h.onReceivedInfos(function(e){switch(console.log("event: "+JSON.stringify(e)),e.data.state){case"ready":var t=e.data.lives;g=e.data.index;for(var n=y;n<t;n++)d(g);y=t,T.innerText="YOU ARE THE PLAYER : "+g;break;case"team":R.innerText="PLAYERS COUNT : "+e.data.player;break;case"close":switch(w.innerText="Closed",e.data.why){case"full":R.innerText="NO MORE PLACE ! SORRY";break;case"started":R.innerText="GAME STARTED ! SORRY"}T.innerText="";break;case"start":w.innerText="PLAYER : "+g,T.innerText="SCORE : .",h.vibrate([20,20,20]);break;case"hit":for(var i=y-e.data.lives,n=0;n<i;n++)l(),h.vibrate([100,50,100,50,100]);y=e.data.lives;break;case"lives":for(var i=e.data.lives-y,n=0;n<i;n++)d(g),h.vibrate([50,50]);break;case"collide":h.vibrate(100);break;case"score":T.innerText="SCORE : "+e.data.score;break;case"kill":w.innerText="Fin de la partie",R.innerText="GAME OVER !",h.close(),h.vibrate([200,50,200,50,200,50,500,50,1e3]);break;case"win":R.innerText="YOU ARE THE WINNER !",T.innerText="SCORE : "+e.data.score,h.vibrate([500,550,500,500,1e3]);break;case"end":w.innerText="FINISHED",h.close()}}),u.addEventListener("pointerdown",a,!1),u.addEventListener("pointermove",s,!1),u.addEventListener("pointerup",c,!1),u.addEventListener("pointerout",c,!1),requestAnimFrame(r)}function n(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}function i(e){u.width=window.innerWidth,u.height=window.innerHeight,f=u.width/2,m=u.height/2,window.scrollTo(0,0)}function o(){u=document.getElementById("canvasSurfaceGame"),n(u),E=u.getContext("2d"),i(),E.strokeStyle="#ffffff",E.lineWidth=2}function r(){E.clearRect(0,0,u.width,u.height),h.pointersList.forEach(function(e){h.isLeftPointer(e.id)?(E.beginPath(),E.strokeStyle="cyan",E.lineWidth=6,E.arc(h.leftPointerStartPos.x,h.leftPointerStartPos.y,40,0,2*Math.PI,!0),E.stroke(),E.beginPath(),E.strokeStyle="cyan",E.lineWidth=2,E.arc(h.leftPointerStartPos.x,h.leftPointerStartPos.y,60,0,2*Math.PI,!0),E.stroke(),E.beginPath(),E.strokeStyle="cyan",E.arc(h.leftPointer.position.x,h.leftPointer.position.y,40,0,2*Math.PI,!0),E.stroke()):(E.beginPath(),E.strokeStyle="red",E.lineWidth="6",E.arc(e.position.x,e.position.y,40,0,2*Math.PI,!0),E.stroke())}),requestAnimFrame(r)}function a(e){h.leftPointer.id<0&&e.clientX<f?h.setLeftPointer(e.pointerId,e.clientX,e.clientY):h.setRightPointer(e.pointerId,e.clientX,e.clientY)}function s(e){h.movePointer(e.pointerId,e.clientX,e.clientY)}function c(e){h.removePointer(e.pointerId)}function d(e){var t=new Image;t.src="/assets/"+P[e]+".png",v.appendChild(t)}function l(){v.removeChild(v.childNodes[1])}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),console.log("REMOTE CONNECTE TO : "+config.address);var u,E,f,m,w,R,v,T,h=new VirtualJoystick.Emiter("http://"+config.address+":"+config.port),P=["fusee_Bleu","fusee_Jaune","fusee_Rouge","fusee_Vert","fusee_Violet","fusee_Gris"],g=-1,y=0;document.addEventListener("DOMContentLoaded",t),window.onorientationchange=i,window.onresize=i}();