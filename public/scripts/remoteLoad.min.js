"use strict";(function(){function e(){S.connect(),i(),R=document.getElementById("viewText"),w=document.getElementById("infosText"),R.innerText="TO START THE PARTY TOUCH WITH TWO FINGERS THE RIGHT PART OF THE SCREEN",w.innerText="NUMBER OF PLAYER : 1",P=document.getElementById("lives"),O=document.getElementById("viewScore"),S.onReceivedClose(function(e){console.log("event: "+JSON.stringify(e)),R.innerText="",w.innerText="DISCONNECT !!"}),S.onReceivedInfos(function(e){switch(console.log("event: "+JSON.stringify(e)),e.data.state){case"ready":var t=e.data.lives;k=e.data.index;for(var n=A;n<t;n++)h(k);A=t,O.innerText="YOU ARE THE PLAYER : "+k;break;case"team":w.innerText="PLAYERS COUNT : "+e.data.player;break;case"close":switch(R.innerText="Closed",e.data.why){case"full":w.innerText="NO MORE PLACE ! SORRY";break;case"started":w.innerText="GAME STARTED ! SORRY"}O.innerText="";break;case"start":R.innerText="PLAYER : "+k,O.innerText="SCORE : .",S.vibrate([20,20,20]);break;case"hit":for(var i=A-e.data.lives,n=0;n<i;n++)v(),S.vibrate([100,50,100,50,100]);A=e.data.lives;break;case"lives":for(var i=e.data.lives-A,n=0;n<i;n++)h(k),S.vibrate([50,50]);break;case"collide":S.vibrate(100);break;case"score":O.innerText="SCORE : "+e.data.score;break;case"kill":R.innerText="",w.innerText="GAME OVER !",S.close(),S.vibrate([200,50,200,50,200,50,500,50,1e3]);break;case"win":w.innerText="YOU ARE THE WINNER !",O.innerText="SCORE : "+e.data.score,S.vibrate([500,550,500,500,1e3]);break;case"end":R.innerText="FINISHED",S.close()}}),E.addEventListener("touchstart",r,!1),E.addEventListener("touchend",a,!1),E.addEventListener("touchcancel",s,!1),E.addEventListener("touchleave",c,!1),E.addEventListener("touchmove",l,!1),requestAnimFrame(o)}function t(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}function n(e){E.width=window.innerWidth,E.height=window.innerHeight,g=E.width/2,m=E.height/2,window.scrollTo(0,0)}function i(){E=document.getElementById("canvasSurfaceGame"),t(E),T=E.getContext("2d"),n(),T.strokeStyle="#ffffff",T.lineWidth=2}function o(){T.clearRect(0,0,E.width,E.height),S.pointersList.forEach(function(e){S.isLeftPointer(e.id)?(T.beginPath(),T.strokeStyle="cyan",T.lineWidth=6,T.arc(S.leftPointerStartPos.x,S.leftPointerStartPos.y,40,0,2*Math.PI,!0),T.stroke(),T.beginPath(),T.strokeStyle="cyan",T.lineWidth=2,T.arc(S.leftPointerStartPos.x,S.leftPointerStartPos.y,60,0,2*Math.PI,!0),T.stroke(),T.beginPath(),T.strokeStyle="cyan",T.arc(S.leftPointer.position.x,S.leftPointer.position.y,40,0,2*Math.PI,!0),T.stroke()):(T.beginPath(),T.strokeStyle="red",T.lineWidth="6",T.arc(e.position.x,e.position.y,40,0,2*Math.PI,!0),T.stroke())}),requestAnimFrame(o)}function r(e){e.preventDefault();var t=e.changedTouches;console.log("DOWN:",t);for(var n=0;n<t.length;n++)d(t[n])}function a(e){e.preventDefault();var t=e.changedTouches;console.log("UP:",t);for(var n=0;n<t.length;n++)f(t[n])}function s(e){e.preventDefault();var t=e.changedTouches;console.log("CANCEL:",t);for(var n=0;n<t.length;n++)f(t[n])}function c(e){e.preventDefault();var t=e.changedTouches;console.log("LEAVE:",t);for(var n=0;n<t.length;n++)f(t[n])}function l(e){e.preventDefault();var t=e.changedTouches;console.log("MOVE:",t);for(var n=0;n<t.length;n++)u(t[n])}function d(e){console.log("DOWN:",e),S.leftPointer.id<0&&e.clientX<g?S.setLeftPointer(e.identifier,e.clientX,e.clientY):S.setRightPointer(e.identifier,e.clientX,e.clientY)}function u(e){console.log("MOVE:",e),S.movePointer(e.identifier,e.clientX,e.clientY)}function f(e){console.log("UP:",e),S.removePointer(e.identifier)}function h(e){var t=new Image;t.src="/assets/"+x[e]+".png",P.appendChild(t)}function v(){P.removeChild(P.childNodes[P.childNodes.length-1])}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),console.log("REMOTE CONNECTE TO : "+config.address);var E,T,g,m,R,w,P,O,S=new VirtualJoystick.Emiter("http://"+config.address+":"+config.port),x=["fusee_Bleu","fusee_Jaune","fusee_Rouge","fusee_Vert","fusee_Violet","fusee_Gris"],k=-1,A=0;document.addEventListener("DOMContentLoaded",e),window.onorientationchange=n,window.onresize=n})();