"use strict";(function(){function e(e){var t=window.matchMedia("(orientation:portrait)");t.matches?document.getElementById("controlView").style.display="block":document.getElementById("controlView").style.display="none"}function t(){window.DeviceOrientationEvent&&(window.addEventListener("deviceorientation",e),e()),A.connect(),o(),R=document.getElementById("viewText"),P=document.getElementById("infosText"),R.innerText="POUR LANCER LA PARTIE TOUCHER AVEC DEUX DOIGTS LA PARTIE DROITE DE L'ECRAN",P.innerText="NUMBER OF PLAYER : 1",O=document.getElementById("lives"),y=document.getElementById("viewScore"),A.onReceivedClose(function(e){console.log("event: "+JSON.stringify(e)),R.innerText="",P.innerText="DISCONNECT !!"}),A.onReceivedInfos(function(e){switch(console.log("event: "+JSON.stringify(e)),e.data.state){case"ready":var t=e.data.lives;k=e.data.index;for(var n=x;n<t;n++)h(k);x=t,y.innerText="YOU ARE THE PLAYER : "+k;break;case"team":P.innerText="PLAYERS COUNT : "+e.data.player;break;case"close":switch(R.innerText="Closed",e.data.why){case"full":P.innerText="NO MORE PLACE ! SORRY";break;case"started":P.innerText="GAME STARTED ! SORRY"}y.innerText="";break;case"start":R.innerText="PLAYER : "+k,y.innerText="SCORE : .",A.vibrate([20,20,20]);break;case"hit":for(var i=x-e.data.lives,n=0;n<i;n++)v(),A.vibrate([100,50,100,50,100]);x=e.data.lives;break;case"lives":for(var i=e.data.lives-x,n=0;n<i;n++)h(k),A.vibrate([50,50]);break;case"collide":A.vibrate(100);break;case"score":y.innerText="SCORE : "+e.data.score;break;case"kill":R.innerText="Fin de la partie",P.innerText="GAME OVER !",A.close(),A.vibrate([200,50,200,50,200,50,500,50,1e3]);break;case"win":P.innerText="YOU ARE THE WINNER !",y.innerText="SCORE : "+e.data.score,A.vibrate([500,550,500,500,1e3]);break;case"end":R.innerText="FINISHED",A.close()}}),g.addEventListener("touchstart",a,!1),g.addEventListener("touchend",s,!1),g.addEventListener("touchcancel",c,!1),g.addEventListener("touchleave",l,!1),g.addEventListener("touchmove",d,!1),requestAnimFrame(r)}function n(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}function i(e){g.width=window.innerWidth,g.height=window.innerHeight,w=g.width/2,T=g.height/2,window.scrollTo(0,0)}function o(){g=document.getElementById("canvasSurfaceGame"),n(g),m=g.getContext("2d"),i(),m.strokeStyle="#ffffff",m.lineWidth=2}function r(){m.clearRect(0,0,g.width,g.height),A.pointersList.forEach(function(e){A.isLeftPointer(e.id)?(m.beginPath(),m.strokeStyle="cyan",m.lineWidth=6,m.arc(A.leftPointerStartPos.x,A.leftPointerStartPos.y,40,0,2*Math.PI,!0),m.stroke(),m.beginPath(),m.strokeStyle="cyan",m.lineWidth=2,m.arc(A.leftPointerStartPos.x,A.leftPointerStartPos.y,60,0,2*Math.PI,!0),m.stroke(),m.beginPath(),m.strokeStyle="cyan",m.arc(A.leftPointer.position.x,A.leftPointer.position.y,40,0,2*Math.PI,!0),m.stroke()):(m.beginPath(),m.strokeStyle="red",m.lineWidth="6",m.arc(e.position.x,e.position.y,40,0,2*Math.PI,!0),m.stroke())}),requestAnimFrame(r)}function a(e){e.preventDefault();var t=e.changedTouches;console.log("DOWN:",t);for(var n=0;n<t.length;n++)u(t[n])}function s(e){e.preventDefault();var t=e.changedTouches;console.log("UP:",t);for(var n=0;n<t.length;n++)E(t[n])}function c(e){e.preventDefault();var t=e.changedTouches;console.log("CANCEL:",t);for(var n=0;n<t.length;n++)E(t[n])}function l(e){e.preventDefault();var t=e.changedTouches;console.log("LEAVE:",t);for(var n=0;n<t.length;n++)E(t[n])}function d(e){e.preventDefault();var t=e.changedTouches;console.log("MOVE:",t);for(var n=0;n<t.length;n++)f(t[n])}function u(e){console.log("DOWN:",e),A.leftPointer.id<0&&e.clientX<w?A.setLeftPointer(e.pointerId,e.clientX,e.clientY):A.setRightPointer(e.pointerId,e.clientX,e.clientY)}function f(e){console.log("MOVE:",e),A.movePointer(e.pointerId,e.clientX,e.clientY)}function E(e){console.log("UP:",e),A.removePointer(e.pointerId)}function h(e){var t=new Image;t.src="/assets/"+S[e]+".png",O.appendChild(t)}function v(){O.removeChild(O.childNodes[1])}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),console.log("REMOTE CONNECTE TO : "+config.address);var g,m,w,T,R,P,O,y,A=new VirtualJoystick.Emiter("http://"+config.address+":"+config.port),S=["fusee_Bleu","fusee_Jaune","fusee_Rouge","fusee_Vert","fusee_Violet","fusee_Gris"],k=-1,x=0;document.addEventListener("DOMContentLoaded",t),window.onorientationchange=i,window.onresize=i})();