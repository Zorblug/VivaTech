"use strict";var VirtualJoystick=VirtualJoystick||{};VirtualJoystick.Joystick=function(t,i){this._parent=i,this.id=t,this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.button=0},VirtualJoystick.Joystick.prototype.reset=function(){this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.button=0},VirtualJoystick.Joystick.prototype.setXY=function(t){console.log("MOVE"+JSON.stringify(t)),0==t.x?(this.left=!1,this.right=!1):t.x>0?(this.left=!1,this.right=!0):t.x<0&&(this.left=!0,this.right=!1),0==t.y?(this.up=!1,this.down=!1):t.y>0?(this.up=!0,this.down=!1):t.y<0&&(this.up=!1,this.down=!0)},VirtualJoystick.Joystick.prototype.setButton=function(t){console.log("BUTTON CLICK"+JSON.stringify(t)),this.button=t.value},VirtualJoystick.Joystick.prototype.send=function(t){this._parent.send(this.id,t)},VirtualJoystick.Joystick.prototype.stringify=function(){return JSON.stringify({id:this.id,left:this.left,right:this.right,up:this.up,down:this.down,button:this.button})},VirtualJoystick.Receiver=function(t){this._serverUrl=t+"/joystick",this._socket,this._events=new ObservableEvents,this._joysticks=new Collection},VirtualJoystick.Receiver.prototype.connect=function(){this._socket=io.connect(this._serverUrl),this._socket.emit("game");var t=this;this._socket.on("remote",function(i){if(!t._joysticks.item(i.id)){var e=new VirtualJoystick.Joystick(i.id,t);t._joysticks.add(i.id,e),t._events.fire("new_remote",{id:i.id,joystick:e})}}),this._socket.on("close",function(i){t._joysticks.remove(i.id),t._events.fire("clear_remote",{id:i.id})}),this._socket.on("move",function(i){t._joysticks.item(i.id)&&t._joysticks.item(i.id).setXY(i.data)}),this._socket.on("button",function(i){t._joysticks.item(i.id)&&t._joysticks.item(i.id).setButton(i.data)}),this._socket.on("click",function(i){t._events.fire("click",{id:i.id,data:i.data,joystick:t._joysticks.item(i.id)})}),this._socket.on("server",function(i){t._events.fire("server",{data:i.data})})},VirtualJoystick.Receiver.prototype.close=function(){this._socket.emit("close"),this._socket.disconnect(),this._socket=null},VirtualJoystick.Receiver.prototype.send=function(t,i){console.log("SEND to "+t+" : "+JSON.stringify(i)),this._socket.emit("info",{id:t,data:i})},VirtualJoystick.Receiver.prototype.broadcast=function(t){console.log("BROADCAST : "+JSON.stringify(t)),this._socket.emit("info",{id:void 0,data:t})},VirtualJoystick.Receiver.prototype.remove=function(t){this._joysticks.remove(t)},VirtualJoystick.Receiver.prototype.stringify=function(){var t="[";return this._joysticks.forEach(function(i){t=t+","+i.stringify()}),t+="]"},VirtualJoystick.Receiver.prototype.onNewRemote=function(t){this._events.addObserver("new_remote",t)},VirtualJoystick.Receiver.prototype.onClearRemote=function(t){this._events.addObserver("clear_remote",t)},VirtualJoystick.Receiver.prototype.onRemoteClick=function(t){this._events.addObserver("click",t)},VirtualJoystick.Receiver.prototype.onReceivedServerMessage=function(t){this._events.addObserver("server",t)};