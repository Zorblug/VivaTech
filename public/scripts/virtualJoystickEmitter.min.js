"use strict";var VirtualJoystick=VirtualJoystick||{};VirtualJoystick.Pointer=function(t,i,e){this.id=t,this.position=new Vector2(i,e)},VirtualJoystick.Pointer.prototype.set=function(t,i,e){this.id=t,this.position.reset(i,e)},VirtualJoystick.Pointer.prototype.reset=function(t,i){this.position.reset(t,i)},VirtualJoystick.Pointer.prototype.copyFromVector=function(t){this.position.copyFrom(t)},VirtualJoystick.Emiter=function(t){this._serverUrl=t+"/joystick",this._socket,this._connected=!1,this._move={x:0,y:0},this._button=0,this.leftPointer=new VirtualJoystick.Pointer(-1,0,0),this.leftPointerStartPos=new Vector2(0,0),this.leftVector=new Vector2(0,0),this.pointersList=new Collection,this._events=new ObservableEvents,navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(console.log("VIBRATE OK"),navigator.vibrate(1e3))},VirtualJoystick.Emiter.prototype.connect=function(){this._socket=io.connect(this._serverUrl),this._socket.emit("remote"),this._connected=!0;var t=this;this._socket.on("info",function(i){console.log("INFO :"+JSON.stringify(i)),t._events.fire("info",i.data)}),this._socket.on("close",function(){console.log("CLOSE "),this._connected=!1,t._socket.disconnect(),t._events.fire("close")}),this._socket.on("server",function(i){t._events.fire("server",{data:i.data})})},VirtualJoystick.Emiter.prototype.close=function(){this._connected=!1,this._socket.emit("close"),this._socket.disconnect()},VirtualJoystick.Emiter.prototype._sendMove=function(){this._connected&&(console.log("MOVE :"+JSON.stringify(this._move)),this._socket.emit("move",this._move))},VirtualJoystick.Emiter.prototype._sendButton=function(){this._connected&&(console.log("RIGHT BUTTON :"+this._button),this._socket.emit("button",{value:this._button}))},VirtualJoystick.Emiter.prototype._sendClick=function(t){this._connected&&(console.log("CLICK :"+JSON.stringify(t)),this._socket.emit("click",t))},VirtualJoystick.Emiter.prototype.setLeftPointer=function(t,i,e){console.log("LEFT X="+i+" Y="+e+" ID="+t),this.leftPointer.set(t,i,e),this.leftPointerStartPos.reset(i,e),this.leftVector.reset(0,0),this.pointersList.add(this.leftPointer.id,this.leftPointer),this.vibrate(15)},VirtualJoystick.Emiter.prototype.movePointer=function(t,i,e){if(this.leftPointer.id==t){var o=!1,s=(i-this.leftPointerStartPos.x)*(i-this.leftPointerStartPos.x),r=(e-this.leftPointerStartPos.y)*(e-this.leftPointerStartPos.y),n=s+r;s>400?i>this.leftPointerStartPos.x&&1!==this._move.x?(this._move.x=1,o=!0):i<this.leftPointerStartPos.x&&this._move.x!==-1&&(this._move.x=-1,o=!0):0!==this._move.x&&(this._move.x=0,o=!0),r>400?e>this.leftPointerStartPos.y&&1!==this._move.y?(this._move.y=1,o=!0):e<this.leftPointerStartPos.y&&this._move.y!==-1&&(this._move.y=-1,o=!0):0!==this._move.y&&(this._move.y=0,o=!0),o&&this._sendMove(),n<3600&&(this.leftPointer.reset(i,e),this.leftVector.copyFrom(this.leftPointer.position),this.leftVector.minusEq(this.leftPointerStartPos))}else this.pointersList.item(t)&&this.pointersList.item(t).reset(i,e)},VirtualJoystick.Emiter.prototype.setRightPointer=function(t,i,e){console.log("RIGHT X="+i+" Y="+e+" ID="+t),this.pointersList.add(t,new VirtualJoystick.Pointer(t,i,e)),this._button+=1,this._sendButton(),this.vibrate(20)},VirtualJoystick.Emiter.prototype.removePointer=function(t){this.leftPointer.id==t?(this.leftPointer.set(-1,0,0),0===this._move.x&&0===this._move.y||(this._move.x=0,this._move.y=0,this._sendMove()),this.vibrate(15),this.leftVector.reset(0,0),console.log("REMOVE LEFT")):(this.pointersList.item(t)&&(this._button-=1,this._sendButton()),console.log("REMOVE RIGHT"));var i=this.pointersList.remove(t);i<=0&&this._button>0&&(this._button=0,this._sendButton())},VirtualJoystick.Emiter.prototype.isLeftPointer=function(t){return this.leftPointer.id==t},VirtualJoystick.Emiter.prototype.onReceivedInfos=function(t){this._events.addObserver("info",t)},VirtualJoystick.Emiter.prototype.onReceivedClose=function(t){this._events.addObserver("close",t)},VirtualJoystick.Emiter.prototype.onReceivedServerMessage=function(t){this._events.addObserver("server",t)},VirtualJoystick.Emiter.prototype.vibrate=function(t){navigator.vibrate&&this._connected&&navigator.vibrate(t)},VirtualJoystick.Emiter.prototype.click=function(t){_sendClick(t)};