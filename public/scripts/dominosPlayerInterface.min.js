"use strict";var Domino=Domino||{};Domino.PlayerInterface=function(e){this.debug=debug("domino.player"),this._playerData=void 0,this._currentTable=void 0,this._turn=-1,this._actived=!1,this.debug("Connect to %s",e),this._socket=io.connect(e+"/domino"),this._events=new ObservableEvents,this._initCallback=void 0,this._playCallback=void 0,this._pickCallback=void 0},Domino.PlayerInterface.prototype.init=function(e,t){"function"==typeof t?this._initCallback=t:this._initCallback=void 0,this._socket.emit("player",e);var a=this;this._socket.on("player",function(e){a.debug("JOUEUR INITIALISE : %s",JSON.stringify(e)),a._playerData=e,a._initCallback&&(a._initCallback.call(a,e),a._initCallback=void 0)}),this._socket.on("new_player",function(e){a.debug("Nouveau joueur : %s",JSON.stringify(e)),a._playerData&&a._playerData.id!==e.player.id&&(a.debug('Event "new_player" : %s',JSON.stringify(e)),a._events.fire("new_player",e))}),this._socket.on("start",function(e){a.debug("Debut de partie : %s",JSON.stringify(e));var t=e.players.collection[a._playerData.id];t&&(a._playerData=t,a._actived=a._playerData.id===e.player.id,a._currentTable=e.table,a._turn=e.turn,a._events.fire("start",e))}),this._socket.on("play",function(e){a.debug("Résultat de l'action : %s",JSON.stringify(e)),e.player&&(a._playerData=e.player,a._currentTable=e.table,a._playCallback&&(a._playCallback.call(a,e),a._playCallback=void 0))}),this._socket.on("end",function(e){a.debug("Fin de la partie : %s",JSON.stringify(e));var t=e.winner.id===a._playerData.id;a._events.fire("end",{iWin:t,winner:e.winner})}),this._socket.on("turn",function(e){a.debug("Tour : %s",JSON.stringify(e)),a._playerData&&(a._actived=a._playerData.id===e.player.id,a._currentTable=e.table,a._turn=e.turn,a._events.fire("turn",e))}),this._socket.on("pick",function(e){a.debug("Résultat de la pioche : %s",JSON.stringify(e)),e.player&&(a._playerData=e.player,a._pickCallback&&(a._pickCallback.call(a,e),a._pickCallback=void 0))}),this._socket.on("timeout",function(e){a.debug("Timeout - le serveur a joué pour le joueur : %s",JSON.stringify(e)),e.player&&(a._playerData=e.player,a._currentTable=e.table,a._events.fire("timeout",e))}),this._socket.on("error",function(e){a._events.fire("error",e)}),this._socket.on("close",function(e){a._events.fire("close",e)})},Domino.PlayerInterface.prototype.emit=function(e,t){this.debug("EMIT %s : %s.",e,JSON.stringify(t)),this._socket.emit(e,t)},Domino.PlayerInterface.prototype.start=function(){this.emit("start")},Domino.PlayerInterface.prototype.getHand=function(){if(this._playerData){var e,t=!1;if(this._actived){var a=this;e=this._playerData.hand.map(function(e,n,i){var r=Domino.PlayerInterface.isDominoPlayable(e,a._currentTable);return t=t||r.some(function(e){return e>=0}),Domino.PlayerInterface.isDominoPlayable(e,a._currentTable)})}else e=this._playerData.hand.map(function(e,t,a){return[-1,-1]});return{hand:this._playerData.hand,playablesDom:e,canPlay:t}}return{hand:[],playablesDom:[],canPlay:!1}},Domino.PlayerInterface.prototype.isActivated=function(){return this._actived},Domino.PlayerInterface.prototype.play=function(e,t,a){"function"==typeof a?this._playCallback=a:this._playCallback=void 0,this.emit("play",{dominoIdx:e,sideIdx:t})},Domino.PlayerInterface.prototype.pick=function(e){"function"==typeof e?this._pickCallback=e:this._pickCallback=void 0,this.emit("pick")},Domino.PlayerInterface.prototype.onStart=function(e){this._events.addObserver("start",e)},Domino.PlayerInterface.prototype.onTurnChange=function(e){this._events.addObserver("turn",e)},Domino.PlayerInterface.prototype.onNewPlayer=function(e){this._events.addObserver("new_player",e)},Domino.PlayerInterface.prototype.onTimeout=function(e){this._events.addObserver("timeout",e)},Domino.PlayerInterface.prototype.onGameOver=function(e){this._events.addObserver("end",e)},Domino.PlayerInterface.prototype.onError=function(e){this._events.addObserver("error",e)},Domino.PlayerInterface.prototype.onClose=function(e){this._events.addObserver("close",e)},Domino.PlayerInterface.isDominoPlayable=function(e,t){var a=[1,1];if(t.length>0){var n=t[0][0],i=t[t.length-1][1];e[0]===n?a[0]=0:e[0]===i?a[0]=1:a[0]=-1,e[1]===n?a[1]=0:e[1]===i?a[1]=1:a[1]=-1}return a};